import{a as j}from"./chunk-ARL6PKL3.js";import{$a as x,Ab as g,Fb as y,Gb as h,Hc as I,Pc as $,Rb as _,S as m,Tb as C,V as M,Wa as i,Wc as w,_ as P,gb as S,i as O,j as l,l as b,lb as p,sb as s,vb as u,yb as c,zb as f}from"./chunk-RTEU5YIX.js";var d=class r{constructor(t){this.http=t}baseUrl=j.apiUrl+"/favoritos";favoritosSubject=new O(new Set);favoritos$=this.favoritosSubject.asObservable();getHeaders(){return{}}cargarFavoritosIniciales(){this.obtenerFavoritos(1,1e3).subscribe({next:t=>{let o=new Set(t.data.favoritos.map(e=>e.receta_id));this.favoritosSubject.next(o)},error:t=>{console.error("Error al cargar favoritos iniciales:",t),this.favoritosSubject.next(new Set)}})}inicializarFavoritos(){this.cargarFavoritosIniciales()}obtenerFavoritos(t=1,o=10,e,n,v,F,z){let a=`${this.baseUrl}?page=${t}&limit=${o}`;return e==="ingrediente"?a+=`&filterCriteria=ingrediente&searchQuery=&ingredientes=${z??""}`:e==="fecha_creacion"||e==="fecha_publicacion"?(a+=`&filterCriteria=${encodeURIComponent(e??"")}`,a+="&searchQuery=",v&&(a+=`&fechaDesde=${encodeURIComponent(v)}`),F&&(a+=`&fechaHasta=${encodeURIComponent(F)}`)):e&&n&&n.trim()!==""&&(a+=`&filterCriteria=${encodeURIComponent(e)}`,a+=`&searchQuery=${encodeURIComponent(n.trim())}`),this.http.get(a,{withCredentials:!0})}agregarFavorito(t){let o=this.getHeaders();return o?this.http.post(`${this.baseUrl}/${t}`,{},{headers:o,withCredentials:!0}).pipe(m(()=>{let e=this.favoritosSubject.value;e.add(t),this.favoritosSubject.next(new Set(e))})):l}quitarFavorito(t){let o=this.getHeaders();return o?this.http.delete(`${this.baseUrl}/${t}`,{headers:o,withCredentials:!0}).pipe(m(()=>{let e=this.favoritosSubject.value;e.delete(t),this.favoritosSubject.next(new Set(e))})):l}alternarFavorito(t){let o=this.getHeaders();return o?this.http.patch(`${this.baseUrl}/alternar/${t}`,{},{headers:o,withCredentials:!0}).pipe(m(e=>{let n=this.favoritosSubject.value;e.data.esFavorito?n.add(t):n.delete(t),this.favoritosSubject.next(new Set(n))})):l}verificarFavorito(t){let o=this.getHeaders();return o?this.http.get(`${this.baseUrl}/verificar/${t}`,{headers:o,withCredentials:!0}):b({data:{esFavorito:!1},message:"No autenticado"})}obtenerEstadisticasFavoritos(t){let o=this.getHeaders();return o?this.http.get(`${this.baseUrl}/estadisticas/${t}`,{headers:o,withCredentials:!0}):b({data:{receta_id:t,totalFavoritos:0},message:"No autenticado"})}esFavorito(t){return this.favoritosSubject.value.has(t)}getFavoritosActuales(){return this.favoritosSubject.value}refrescarFavoritos(){this.cargarFavoritosIniciales()}static \u0275fac=function(o){return new(o||r)(P(w))};static \u0275prov=M({token:r,factory:r.\u0275fac,providedIn:"root"})};function k(r,t){if(r&1&&(c(0,"span",6),_(1),f()),r&2){let o=h();i(),C(" ",o.totalFavoritos," ")}}function T(r,t){r&1&&g(0,"i",7)}function H(r,t){if(r&1&&(c(0,"span",8),_(1),f()),r&2){let o=h();i(),C(" ",o.textoBoton," ")}}var E=class r{constructor(t){this.favoritosService=t}recetaId;mostrarTexto=!1;tama\u00F1o="medium";variante="outlined";esFavorito=!1;cargando=!1;totalFavoritos=0;favoritosSubscription;ngOnInit(){this.verificarEstadoFavorito(),this.cargarEstadisticas(),this.favoritosSubscription=this.favoritosService.favoritos$.subscribe(()=>{this.verificarEstadoFavorito()})}ngOnDestroy(){this.favoritosSubscription&&this.favoritosSubscription.unsubscribe()}verificarEstadoFavorito(){this.esFavorito=this.favoritosService.esFavorito(this.recetaId)}cargarEstadisticas(){this.favoritosService.obtenerEstadisticasFavoritos(this.recetaId).subscribe({next:t=>{t.success&&(this.totalFavoritos=t.data.totalFavoritos)},error:t=>{console.error("Error al cargar estad\xEDsticas de favoritos:",t)}})}alternarFavorito(){this.cargando||(this.cargando=!0,this.esFavorito?this.favoritosService.quitarFavorito(this.recetaId).subscribe({next:t=>{t.success&&(this.esFavorito=!1,this.totalFavoritos=Math.max(0,this.totalFavoritos-1)),this.cargando=!1},error:t=>{console.error("Error al quitar favorito:",t),this.cargando=!1}}):this.favoritosService.agregarFavorito(this.recetaId).subscribe({next:t=>{t.success&&(this.esFavorito=!0,this.totalFavoritos++),this.cargando=!1},error:t=>{console.error("Error al agregar favorito:",t),t.status===409&&(this.esFavorito=!0,console.info("La receta ya estaba en favoritos, sincronizando estado")),this.cargando=!1}}))}get iconoClase(){let t="boton-favorito",o=`boton-favorito--${this.tama\u00F1o}`,e=`boton-favorito--${this.variante}`,n=this.esFavorito?"boton-favorito--favorito":"",v=this.cargando?"boton-favorito--cargando":"";return`${t} ${o} ${e} ${n} ${v}`.trim()}get iconoCorazon(){return this.esFavorito?"fas fa-heart":"far fa-heart"}get textoBoton(){return this.cargando?"Cargando...":this.esFavorito?"Quitar de favoritos":"Agregar a favoritos"}static \u0275fac=function(o){return new(o||r)(x(d))};static \u0275cmp=S({type:r,selectors:[["app-boton-favorito"]],inputs:{recetaId:"recetaId",mostrarTexto:"mostrarTexto",tama\u00F1o:"tama\xF1o",variante:"variante"},decls:6,vars:9,consts:[["type","button",3,"click","disabled","title"],[1,"boton-favorito__corazon-container"],["aria-hidden","true"],["class","boton-favorito__contador-interno",4,"ngIf"],["class","fas fa-spinner fa-spin boton-favorito__spinner","aria-hidden","true",4,"ngIf"],["class","boton-favorito__texto",4,"ngIf"],[1,"boton-favorito__contador-interno"],["aria-hidden","true",1,"fas","fa-spinner","fa-spin","boton-favorito__spinner"],[1,"boton-favorito__texto"]],template:function(o,e){o&1&&(c(0,"button",0),y("click",function(){return e.alternarFavorito()}),c(1,"div",1),g(2,"i",2),p(3,k,2,1,"span",3),f(),p(4,T,1,0,"i",4)(5,H,2,1,"span",5),f()),o&2&&(u(e.iconoClase),s("disabled",e.cargando)("title",e.textoBoton),i(2),u(e.iconoCorazon),i(),s("ngIf",e.totalFavoritos>0),i(),s("ngIf",e.cargando),i(),s("ngIf",e.mostrarTexto))},dependencies:[$,I],styles:[".boton-favorito[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;border:none;background:transparent!important;cursor:pointer;transition:all .3s ease;border-radius:50%;padding:.25rem;position:relative;font-family:inherit}.boton-favorito[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.boton-favorito[_ngcontent-%COMP%]:active{transform:scale(.95)}.boton-favorito[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.6;transform:none!important}.boton-favorito__corazon-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center}.boton-favorito__contador-interno[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:.6rem;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,.8);pointer-events:none;z-index:2;line-height:1}.boton-favorito--small[_ngcontent-%COMP%]{padding:.125rem;font-size:1.5rem}.boton-favorito--small[_ngcontent-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%]{font-size:1rem}.boton-favorito--medium[_ngcontent-%COMP%]{padding:.25rem;font-size:3.6rem}.boton-favorito--medium[_ngcontent-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%]{font-size:1.3rem}.boton-favorito--large[_ngcontent-%COMP%]{padding:.375rem;font-size:4.6rem}.boton-favorito--large[_ngcontent-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%]{font-size:1.5rem}.boton-favorito--cargando[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%]:not(.boton-favorito__spinner){opacity:.3}.boton-favorito__spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.boton-favorito__texto[_ngcontent-%COMP%]{white-space:nowrap;font-weight:500;margin-left:.5rem}.boton-favorito[_ngcontent-%COMP%]   .fa-heart[_ngcontent-%COMP%]{transition:all .3s ease;filter:drop-shadow(0 2px 4px rgba(0,0,0,.1))}.boton-favorito[_ngcontent-%COMP%]   .fa-heart.fas[_ngcontent-%COMP%]{color:#ff4757;animation:_ngcontent-%COMP%_heartbeat .6s ease-in-out}.boton-favorito[_ngcontent-%COMP%]   .fa-heart.far[_ngcontent-%COMP%]{color:#999}.boton-favorito[_ngcontent-%COMP%]   .fa-heart[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.boton-favorito--favorito[_ngcontent-%COMP%]   .fa-heart[_ngcontent-%COMP%]{color:#ff4757!important}.boton-favorito--favorito[_ngcontent-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%]{color:#fff}.boton-favorito[_ngcontent-%COMP%]:not(.boton-favorito--favorito)   .fa-heart[_ngcontent-%COMP%]{color:#999!important}.boton-favorito[_ngcontent-%COMP%]:not(.boton-favorito--favorito)   .boton-favorito__contador-interno[_ngcontent-%COMP%]{color:#000;text-shadow:1px 1px 2px rgba(255,255,255,.8)}@media (max-width: 768px){.boton-favorito--large[_ngcontent-%COMP%]{font-size:3rem}.boton-favorito--medium[_ngcontent-%COMP%]{font-size:2.5rem}.boton-favorito--small[_ngcontent-%COMP%]{font-size:2rem}}@media (max-width: 600px){.boton-favorito[_ngcontent-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%]{display:none!important}}@keyframes _ngcontent-%COMP%_heartbeat{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}body.dark-theme[_nghost-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%], body.dark-theme   [_nghost-%COMP%]   .boton-favorito__texto[_ngcontent-%COMP%], body.dark-theme[_nghost-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%], body.dark-theme   [_nghost-%COMP%]   .boton-favorito__contador-interno[_ngcontent-%COMP%]{color:#e3eafc!important}"]})};export{d as a,E as b};
